# 音乐分析功能特性清单

## 特性概述
音乐分析功能旨在为用户提供深入的音乐收听行为分析和个性化推荐。该功能包括音乐偏好报告生成、定时报告调度和智能音乐推荐三个核心模块。

## 功能详情

### 1. 音乐偏好分析报告
- **功能描述**: 生成用户的音乐收听偏好报告，包括总曲目数、播放次数最多的曲目和最近播放的曲目。
- **数据来源**: 基于本地数据库中的播放记录和播放统计信息。
- **输出格式**: 控制台文本报告，包含统计信息和排名列表。

### 2. 定时报告生成
- **功能描述**: 支持按指定时间间隔自动定时生成音乐偏好分析报告。
- **配置选项**: 可通过命令行参数设置报告生成间隔（如每小时、每天、每周）。
- **运行方式**: 作为后台服务持续运行，在指定时间点生成报告。

### 3. 智能音乐推荐
- **功能描述**: 基于用户的历史播放记录和播放统计信息，生成个性化的音乐推荐列表。
- **推荐算法**: 
  - 综合考虑播放次数、最近播放频率、艺术家和专辑偏好等因素
  - 使用加权算法计算推荐分数
  - 支持全局推荐和特定艺术家推荐两种模式
- **输出格式**: 控制台文本列表，包含推荐曲目和推荐分数。

## 技术实现

### 核心组件
- `report.go`: 负责生成音乐偏好分析报告
- `recommendation.go`: 实现音乐推荐算法
- `analysis_cmd.go`: 提供命令行接口

### 数据模型依赖
- `TrackPlayRecord`: 播放记录模型，用于获取最近播放历史
- `TrackPlayCount`: 播放统计模型，用于计算播放频率

### 算法说明
1. **推荐分数计算**:
   - 基础分数 = 播放次数
   - 艺术家权重 = 1.0 + ln(艺术家播放频率+1)
   - 专辑权重 = 1.0 + ln(专辑播放频率+1)
   - 最终分数 = 基础分数 × 艺术家权重 × 专辑权重

2. **定时调度**:
   - 使用Go标准库的`time.Ticker`实现定时触发
   - 支持通过context控制任务生命周期

## 使用说明

### 命令行接口
- `music-analysis generate-report`: 生成一次音乐偏好分析报告
- `music-analysis schedule-report -i <间隔>`: 启动定时报告生成服务
- `music-analysis generate-recommendations -l <数量> [-a <艺术家>]`: 生成音乐推荐

### 配置要求
- 需要正确配置数据库连接
- 需要初始化日志系统

## 未来扩展
1. 增加更多维度的分析（如按时间段、曲风等）
2. 支持导出报告为文件（JSON、CSV等格式）
3. 增加Web界面展示分析结果
4. 优化推荐算法，引入机器学习模型